<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../bower_components/polymerfire/firebase-firestore-mixin.html">
<link rel="import" href="hb-page-layout.html">
<link rel="import" href="hb-config.html">

<dom-module id="hb-home">
    <template>
         <style>
            :host {
                display: block;
                height: 100%;
            }

            [slot="app-toolbar"] a {
                color: inherit;
            }

            main {
                padding: 16px 0;
            }

            [main-title] {
                font-size: inherit;
                font-weight: inherit;
            }

            @media all and (min-width: 641px) {
                main {
                    padding: 32px 64px;
                }
            }
        </style>
        <div hidden$="[[appReady]]">
            Loading Home
        </div>
        <template is="dom-if" if="[[_showNoHome(appReady, app)]]" restamp>
            <hb-config config="{{config}}"></hb-config>
            <hb-page-layout>
                <div slot="title">
                    <h1 main-title>[[config.applicationTitle]]</h1>
                </div>
                <main>
                There is no home page<br>
                Another line
                NEED MAIN HERE?<br>
                asdf<br>
                asdf<br>
                asdf<br>
                asdf<br>
                asdf<br>
                asdf<br>
                asdf<br>
                asdf<br>
                asdf<br>
                asdf<br>
                asdf<br>
                asdf<br>
                </main>
            </hb-page-layout>
        </template>
        
    </template>
    <script>
    /**
     * @customElement
     * @polymer
     */
    class HbHome extends Polymer.FirestoreMixin(Polymer.Element) {
        static get is() { return 'hb-home'; }
    
        static get properties() {
            return {
                app: {
                    type: Object,
                    doc: "system/app",
                    live: true,
                    observer: "_appChanged"
                },
                
                appReady: {
                    type: Boolean,                    
                    value: false
                },
    
                route: {
                    type: Object,
                    observer: "_routeChanged"
                }
            };
        }

        _showNoHome(appReady, app) {
            return this.appReady && (!this.app.homeDoc || !this.app.homeDoc.docId);
        }

        _appChanged() {
            if (!this.app || !this.app.homeDoc || !this.app.homeDoc.docId) {
                if (this.home) {
                    this.home.remove();
                    this._showNoHome(this.appReady);
                }
                return;
            }

            const {docId, docType} = this.app.homeDoc;
            if (this.home) {
                this.home.remove();
            }

            this.home = document.createElement(docType);
            this.home.docId = docId;
            this.home.route = this.route;
            this.shadowRoot.appendChild(this.home);            
        }

        _routeChanged() {
            if (this.home) {
                this.home.route = this.route;
            }
        }
    
    }
    
    window.customElements.define(HbHome.is, HbHome);
    </script>
            
</dom-module>
