<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../bower_components/polymerfire/firebase-firestore-mixin.html">
<link rel="import" href="hb-no-home-page.html">
<link rel="import" href="hb-config.html">

<dom-module id="hb-home">
    <template>
         <style>
            :host {
                display: block;
                height: 100%;
            }

            [slot="app-toolbar"] a {
                color: inherit;
            }

            main {
                padding: 16px 0;
            }

            [main-title] {
                font-size: inherit;
                font-weight: inherit;
            }

            @media all and (min-width: 641px) {
                main {
                    padding: 32px 64px;
                }
            }

            .loading-home {
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background-color: var(--primary-header-background-color);
                color: var(--primary-header-color);
                text-align: center;
                padding-top: 4rem;
                font-weight: 100;
                font-size: 3rem;
            }
        </style>
        <div hidden$="[[appReady]]">
            <div class="loading-home">
                <hb-config config="{{config}}"></hb-config>
                [[config.applicationTitle]]...
            </div>
        </div>
        <template is="dom-if" if="[[!_hasHome(appReady, app)]]" restamp>
            <hb-no-home-page></hb-no-home-page>
        </template>
        <template is="dom-if" if="[[_hasHome(appReady, app)]]" restamp>
            <div id="homePage">HAS HOME PAGE</div>            
        </template>
    </template>
    <script>
    /**
     * @customElement
     * @polymer
     */
    class HbHome extends Polymer.FirestoreMixin(Polymer.Element) {
        static get is() { return 'hb-home'; }
    
        static get properties() {
            return {
                app: {
                    type: Object,
                    doc: "system/app",
                    live: true,
                    observer: "_appChanged"
                },
                
                appReady: {
                    type: Boolean,                    
                    value: false
                },
    
                route: {
                    type: Object,
                    observer: "_routeChanged"
                }
            };
        }

        _hasHome(appReady, app) {
            return this.appReady && (this.app.homeDoc && this.app.homeDoc.docId);
        }

        _appChanged() {
            if (!this.app || !this.app.homeDoc || !this.app.homeDoc.docId) {
                if (this.home) {
                    this.home.remove();
                    this._hasHome(this.appReady);
                }
                return;
            }

            const {docId, docType} = this.app.homeDoc;
            if (this.home) {
                this.home.remove();
            }

            this.home = document.createElement(docType);
            this.home.docId = docId;
            this.home.route = this.route;
            this.shadowRoot.appendChild(this.home);
        }

        _routeChanged() {
            if (this.home) {
                this.home.route = this.route;
            }
        }
    
    }
    
    window.customElements.define(HbHome.is, HbHome);
    </script>
            
</dom-module>
