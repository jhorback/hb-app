<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../bower_components/polymerfire/firebase-firestore-mixin.html">
<dom-module id="hb-home">
    <template>
        <div hidden$="[[appReady]]">
            Loading Home
        </div>
        <div hidden$="[[!_showNoHome(appReady, app)]]">
            No Home Page
        </div>
    </template>
    <script>
    /**
     * @customElement
     * @polymer
     */
    class HbHome extends Polymer.FirestoreMixin(Polymer.Element) {
        static get is() { return 'hb-home'; }
    
        static get properties() {
            return {
                app: {
                    type: Object,
                    doc: "system/app",
                    live: true,
                    observer: "_appChanged"
                },
                
                appReady: {
                    type: Boolean,                    
                    value: false
                },
    
                route: {
                    type: Object,
                    observer: "_routeChanged"
                }
            };
        }

        _showNoHome(appReady, app) {
            return this.appReady && (!this.app.homeDoc || !this.app.homeDoc.docId);
        }

        _appChanged() {
            if (!this.app || !this.app.homeDoc || !this.app.homeDoc.docId) {
                if (this.home) {
                    this.home.remove();
                    this._showNoHome(this.appReady);
                }
                return;
            }

            const {docId, docType} = this.app.homeDoc;
            if (this.home) {
                this.home.remove();
            }

            this.home = document.createElement(docType);
            this.home.docId = docId;
            this.home.setAttribute("docId", docId);
            this.home.route = this.route;
            this.shadowRoot.appendChild(this.home);            
        }

        _routeChanged() {
            if (this.home) {
                this.home.route = this.route;
            }
        }
    
    }
    
    window.customElements.define(HbHome.is, HbHome);
    </script>
            
</dom-module>
