<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../bower_components/app-layout/app-scroll-effects/app-scroll-effects.html">
<link rel="import" href="../../bower_components/app-layout/app-drawer-layout/app-drawer-layout.html">
<link rel="import" href="../../bower_components/app-layout/app-drawer/app-drawer.html">
<link rel="import" href="../../bower_components/app-layout/app-header-layout/app-header-layout.html">
<link rel="import" href="../../bower_components/app-layout/app-header/app-header.html">
<link rel="import" href="../../bower_components/app-layout/app-scroll-effects/app-scroll-effects.html">
<link rel="import" href="../../bower_components/app-layout/app-toolbar/app-toolbar.html">
<link rel="import" href="../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/paper-item/paper-item.html">
<link rel="import" href="../../bower_components/paper-item/paper-item-body.html">
<link rel="import" href="hb-user-profile-data.html">

<dom-module id="hb-user-profile-page">

  <template>
    <style include="hb-page-layout-shared-styles"></style>
    <style>
        .profile-name {
            padding-top: 5rem;
            max-width: 800px;
            margin: 2rem auto;
            @apply --paper-font-subhead;
            font-size: 2rem;
            text-align: center;
            color: var(--primary-text-color);
        }
        .profile-name .avatar {
            border-radius:50%;
            width: 150px;
            margin-bottom: 1rem;
        }
        .profile-details {
            max-width: 800px;
            margin: auto;
            margin-top: 9rem;
            margin-bottom: 2rem;
        }
        .no-avatar-spacer {
            margin-top: 2.5em;
        }
        .logout-button {
            font-size: 1rem;
        }
    </style>
    <hb-user-profile-data uid="[[uid]]" user="{{user}}"></hb-user-profile-data>
    <app-header-layout>
        <app-header slot="header" effects="waterfall">
            <app-toolbar>
                <paper-icon-button icon="[[_getBackIcon()]]" on-tap="_goBack"></paper-icon-button>
                <div main-title></div>
                <paper-button
                    hidden$="[[!isCurrentUser]]"
                    class="logout-button"
                    on-tap="_signOut">
                        Sign Out
                </paper-button>            
            </app-toolbar>
            <app-toolbar>                
                <div class="profile-name">
                    <img class="avatar" src="[[user.photoURL]]" hidden$="[[!user.photoURL]]">
                    <div class="no-avatar-spacer" hidden$="[[user.photoURL]]"></div>
                    <div>
                        [[user.displayName]]
                    </div>
                </div>
            </app-toolbar>
        </app-header>
        <main>
        <!-- main content -->
        
        <div class="profile-details">
            <div>
                <paper-item>                
                    <paper-item-body two-line>
                        <div>Last login</div>
                        <div secondary>[[_getLastLogin(user)]]</div>
                    </paper-item-body>    
                </paper-item>
                <paper-item hidden$="[[!user.email]]">                
                    <paper-item-body two-line>
                        <div>Email</div>
                        <div secondary>[[user.email]]</div>
                    </paper-item-body>    
                </paper-item>
                <paper-item>                
                    <paper-item-body two-line>
                        <div>Permissions</div>
                        <div secondary>[[_getPermissionsDescription(user)]]</div>
                    </paper-item-body>    
                </paper-item>
            </div>
        </div>
        
        <!-- logout button ?? where -->
        
        
        </main>
    </app-header-layout>
  </template>

    <script>
    /**
    * @customElement
    * @polymer
    */
    class HbUserProfilePage extends Polymer.Element {
        static get is() { return 'hb-user-profile-page'; }
        
        static get properties() {
            return {
                uid: {
                    type: String
                },
                isCurrentUser: {
                    type: Boolean,
                    value: false
                }
            };
        }

        // duplicated on the user list
        // could make this a static method on the user domain object
        _getPermissionsDescription(user) {
            if (!user || !user.permissions) {
                return "";
            }

            const description = [];
            const {permissions} = user;
            if (permissions.isSysAdmin) {
                description.push("System admin");
            }
            if (permissions.isSiteAdmin) {
                description.push("Site admin");
            }            
            if (permissions.isAuthor) {
                description.push("Author");
            }

            return description.length > 0 ?
                description.join(", ") :
                "None";
        }

        // another method for the user domain object
        _getLastLogin(user) {
            return user && user.lastLogin ?
                `Last login: ${user.lastLogin.toLocaleString()}` :
                "Never logged in";
        }

        _goBack(event) {
            window.history.back();
        }

        _signOut(event) {
            window.dispatchEvent(new CustomEvent("user-sign-out"));
        }

        _getBackIcon() {
            return this.isCurrentUser ? "hb:close" : "hb:arrow-back";
        }
    }

    window.customElements.define(HbUserProfilePage.is, HbUserProfilePage);
    </script>
</dom-module>
